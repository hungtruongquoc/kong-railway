FROM kong:latest

ARG POSTGRES_HOST
ARG POSTGRES_USER
ARG POSTGRES_PASSWORD
ARG POSTGRES_DB

ENV KONG_DATABASE=postgres
ENV KONG_PG_HOST=$POSTGRES_HOST
ENV KONG_PG_USER=$POSTGRES_USER
ENV KONG_PG_PASSWORD=$POSTGRES_PASSWORD
ENV KONG_PG_DATABASE=$POSTGRES_DB

COPY wait-for-it.sh /wait-for-it.sh
RUN chmod +x /wait-for-it.sh

CMD ["kong", "migrations", "bootstrap"]
